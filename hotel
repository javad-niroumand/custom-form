<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Booking Information</title>
  <script src="/sdk/app-page-sdk.js"></script>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      display: grid;
      place-items: center;
      background: #f7f9fc;
      font-family: system-ui, sans-serif;
    }

    .reservation-form {
      width: 100%;
      max-width: 400px;
      padding: 2.5rem 2rem 2rem;
      background: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .reservation-form h2 {
      margin: 0 0 1rem;
      font-size: 1.35rem;
      font-weight: 600;
      text-align: center;
      color: #333;
    }

    .logo {
      display: block;
      margin: 0 auto 1rem;
      max-width: 150px;
    }

    .reservation-form input, .reservation-form select {
      width: 100%;
      padding: 0.75rem 0.9rem;
      margin-bottom: 1rem;
      border: 1px solid #d0d7de;
      border-radius: 0.6rem;
      font-size: 0.95rem;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .reservation-form input:focus, .reservation-form select:focus {
      border-color: #4c9aff;
      box-shadow: 0 0 0 3px rgba(76, 154, 255, 0.25);
      outline: none;
    }

    .reservation-form button {
      width: 100%;
      padding: 0.8rem 0.9rem;
      border: none;
      border-radius: 0.6rem;
      background: #4c9aff;
      color: #fff;
      font-size: 0.97rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .reservation-form button:hover {
      background: #337dff;
    }

    .image-slider {
      display: flex;
      overflow-x: auto;
      gap: 0.5rem;
      margin-bottom: 1rem;
      scroll-snap-type: x mandatory;
    }

    .image-slider img {
      flex: 0 0 auto;
      width: 100%;
      max-width: 360px;
      border-radius: 0.8rem;
      scroll-snap-align: start;
    }

    .rating {
      margin-bottom: 1rem;
      font-size: 1rem;
      color: #ffb400;
      text-align: center;
    }

    .price {
      font-weight: 600;
      margin: 0.75rem 0 1.5rem;
      text-align: center;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      gap: 0.5rem;
    }

    .checkbox-container input {
      margin: 0;
    }
  </style>
</head>

<body>
  <form id="reservation-form" class="reservation-form">
    <!-- Logo -->
    <img src="https://www.e-domizil.de/assets/logo/logo.svg" alt="Logo" class="logo">

    <h2>Booking Information</h2>

    <!-- Image Slider -->
    <div class="image-slider">
      <img src="https://cdn.hometogo.net/large/v1/d13/2a6/13a3ac62bf042333d95b602403.jpg" alt="Apartment Image 1">
      <img src="https://cdn.hometogo.net/medium/e_v5/ef7/3b6/ed2b5aea80de7e2015fa954738.jpg" alt="Apartment Image 2">
      <img src="https://cdn.hometogo.net/large/v1/652/9d5/f0b7e825114e7b970f3f18dc71.jpg" alt="Apartment Image 3">
      <img src="https://cdn.hometogo.net/medium/v1/0e6/870/73e465271f1832234bb682d285.jpg" alt="Apartment Image 4">
      <img src="https://cdn.hometogo.net/large/v1/2c4/1c0/bb748f7914a833ea9b70790e61.jpg" alt="Apartment Image 5">
    </div>

    <!-- Rating -->
    <div class="rating">⭐⭐⭐⭐½ (4.5)</div>

    <!-- Input fields -->
    <input type="text" id="fullname" name="fullname" placeholder="Fullname" required autocomplete="name" />
    <input type="text" id="apartmentName" name="apartmentName" placeholder="Apartment Name" required autocomplete="off" />
    <input type="date" id="checkInDate" name="checkInDate" required />
    <input type="time" id="checkInTime" name="checkInTime" required />
    <input type="date" id="checkOutDate" name="checkOutDate" required />
    <input type="time" id="checkOutTime" name="checkOutTime" required />

    <!-- Pet checkbox -->
    <div class="checkbox-container">
      <input type="checkbox" id="hasPet" name="hasPet" />
      <label for="hasPet">I am bringing a pet (€3/day)</label>
    </div>

    <!-- Total Price -->
    <div class="price" id="totalPrice">Total Price: €450</div>

    <button type="submit">Confirm Booking</button>
  </form>

  <script>
    function setupForm() {
      // Prefill fields from AI agent data if available
      const fullname = "{{ input.aiAgent.toolArgs.fullname }}";
      const apartmentName = "{{ input.aiAgent.toolArgs.apartmentName }}";
      const checkInDateVal = "{{ input.aiAgent.toolArgs.checkInDate }}";
      const checkOutDateVal = "{{ input.aiAgent.toolArgs.checkOutDate }}";

      if (fullname && fullname.trim()) document.getElementById('fullname').value = fullname;
      if (apartmentName && apartmentName.trim()) document.getElementById('apartmentName').value = apartmentName;
      if (checkInDateVal) document.getElementById('checkInDate').value = checkInDateVal;
      if (checkOutDateVal) document.getElementById('checkOutDate').value = checkOutDateVal;

      const basePrice = 450;
      const totalPriceEl = document.getElementById('totalPrice');

      function calculatePrice() {
        const checkIn = new Date(document.getElementById('checkInDate').value);
        const checkOut = new Date(document.getElementById('checkOutDate').value);
        let diffDays = (checkOut - checkIn) / (1000 * 60 * 60 * 24);
        diffDays = diffDays > 0 ? diffDays : 0;

        const petCost = document.getElementById('hasPet').checked ? diffDays * 3 : 0;
        totalPriceEl.textContent = `Total Price: €${basePrice + petCost}`;
      }

      document.getElementById('checkInDate').addEventListener('change', calculatePrice);
      document.getElementById('checkOutDate').addEventListener('change', calculatePrice);
      document.getElementById('hasPet').addEventListener('change', calculatePrice);

      calculatePrice();

      // Form submission
      document.getElementById('reservation-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const formData = {
          fullname: document.getElementById('fullname').value,
          apartmentName: document.getElementById('apartmentName').value,
          checkInDate: document.getElementById('checkInDate').value,
          checkInTime: document.getElementById('checkInTime').value,
          checkOutDate: document.getElementById('checkOutDate').value,
          checkOutTime: document.getElementById('checkOutTime').value,
          hasPet: document.getElementById('hasPet').checked,
          totalPrice: totalPriceEl.textContent.replace("Total Price: €", "")
        };

        if (window.CognigyApp && window.CognigyApp.submit) {
          await window.CognigyApp.submit(formData);
          await window.CognigyApp.setContext(formData);
        } else if (window.SDK && window.SDK.submit) {
          SDK.submit(formData);
        }

        console.log('Form submitted:', formData);
      });
    }

    document.addEventListener("DOMContentLoaded", setupForm);
  </script>
</body>
</html>
