<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rückruf Informationen</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --purple:#8b5cf6;
}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:#f4f4f4;
  display:flex;
  flex-direction:column;
  align-items:center;
  color:#222;
}
header{
  background:#fff;
  width:100%;
  text-align:center;
  padding:10px 0;
}
header img{height:40px;}
header h1{margin:5px 0 0;font-size:18px;color:var(--purple);font-weight:600}

/* Banner */
.top-banner{
  background:var(--purple);
  padding:12px;
  display:flex;
  flex-direction:column;
  border-radius:12px;
  color:white;
  width:100%;
  max-width:420px;
  box-sizing:border-box;
  margin:10px auto;
}
.banner-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:600;
  margin-bottom:8px;
  font-size:14px;
}
.banner-header span{cursor:pointer;}
.dates{
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  gap:4px;
  -webkit-overflow-scrolling:touch;
  padding-bottom:6px;
}
.date-item{
  min-width:60px;
  flex:0 0 auto;
  background:rgba(255,255,255,0.1);
  border:1px solid rgba(255,255,255,0.3);
  border-radius:8px;
  text-align:center;
  padding:4px 0;
  font-size:11px;
  cursor:pointer;
  scroll-snap-align:center;
}
.date-item .dom{display:block;font-size:13px;font-weight:700;}
.date-item.active{background:#fff;color:var(--purple);}

/* Clock with scrolling digits */
.clock-container{
  display:flex;
  background:#fff;
  padding:10px;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  font-size:36px;
  font-weight:bold;
  color:var(--purple);
  width:100%;
  max-width:420px;
  box-sizing:border-box;
  justify-content:center;
  margin-top:8px;
}
.digit-column{
  width:40px;
  height:50px;
  overflow-y:scroll;
  scrollbar-width:none;
  -ms-overflow-style:none;
  text-align:center;
  scroll-snap-type:y mandatory;
}
.digit-column::-webkit-scrollbar{display:none;}
.digit{
  height:50px;
  line-height:50px;
  scroll-snap-align:start;
}
.separator{
  line-height:50px;
  margin:0 5px;
}

/* Appointment boxes */
.appointments{
  width:100%;
  max-width:420px;
  margin:5px auto;
}
.appointment-box{
  background:#fff;
  padding:12px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  margin-bottom:8px;
}
.appointment-box h3{
  margin:0 0 3px;
  font-size:14px;
  color:var(--purple);
}
.appointment-box p{margin:0;font-size:13px;}

/* Buttons */
.buttons{
  width:100%;
  max-width:420px;
  margin:10px auto;
  text-align:center;
}
.save-btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:var(--purple);
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}

/* Service icons */
.service-icons{
  width:100%;
  max-width:420px;
  display:flex;
  justify-content:space-around;
  margin-top:8px;
}
.service-icons .icon{
  background:var(--purple);
  color:#fff;
  width:50px;
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size:20px;
}
.service-text{
  width:100%;
  max-width:420px;
  text-align:center;
  font-size:14px;
  font-weight:500;
  margin-top:6px;
  color:#333;
}

/* Banner at bottom */
.banner{
  width:100%;
  max-width:420px;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 0 15px rgba(0,0,0,0.15);
  margin:15px auto;
}
.banner img{width:100%;display:block;}
</style>
</head>
<body>

<header>
  <img src="https://intranet.gruendungswerft.com/wp-content/uploads/2024/05/1komma5.png">
  <h1>Rückruf Informationen</h1>
</header>

<div class="top-banner">
  <div class="banner-header">
    <span id="prevMonth">&lt;</span>
    <span id="monthLabel">Monat</span>
    <span id="nextMonth">&gt;</span>
  </div>
  <div class="dates" id="datesRow"></div>
</div>

<!-- Clock -->
<div class="clock-container">
  <div class="digit-column" id="hTens"></div>
  <div class="digit-column" id="hOnes"></div>
  <div class="separator">:</div>
  <div class="digit-column" id="mTens"></div>
  <div class="digit-column" id="mOnes"></div>
</div>

<div class="appointments">
  <div class="appointment-box">
    <h3>Kunde</h3>
    <p id="userName">–</p>
  </div>
  <div class="appointment-box">
    <h3>Telefonnummer</h3>
    <p id="userPhone">–</p>
  </div>
</div>

<div class="buttons">
  <button class="save-btn" id="saveBtn">Rückruf anpassen</button>
</div>

<div class="service-icons">
  <div class="icon"><i class="fa-solid fa-envelope"></i></div>
  <div class="icon"><i class="fa-solid fa-phone"></i></div>
  <div class="icon"><i class="fa-brands fa-whatsapp"></i></div>
</div>
<div class="service-text">
  Unser Kundenservice ist <strong>24&nbsp;Stunden</strong> für Sie erreichbar.
</div>

<a href="https://1komma5.com/de/heartbeat/" target="_blank" class="banner">
  <img src="https://github.com/javad-niroumand/Lisa/blob/main/Screenshot%202025-09-17%20231416.jpg?raw=true" alt="Heartbeat AI Banner">
</a>

<script>
const apiUrl="https://6797e9d9c2c861de0c6e6bdf.mockapi.io/costumerData/1";
const datesRow=document.getElementById('datesRow');
const monthLabel=document.getElementById('monthLabel');
let currentBaseDate=new Date();

// fill digits for the clock
function fillDigits(col,max){
  col.innerHTML='';
  for(let i=0;i<max;i++){
    const d=document.createElement('div');
    d.className='digit';
    d.textContent=i;
    col.appendChild(d);
  }
}
function setScroll(col,idx){col.scrollTop=idx*50;}
function getSelectedIndex(col){return Math.round(col.scrollTop/50);}
function getSelectedValue(col){
  return parseInt(col.children[getSelectedIndex(col)].textContent);
}

// prepare columns
const hTens=document.getElementById('hTens');
const hOnes=document.getElementById('hOnes');
const mTens=document.getElementById('mTens');
const mOnes=document.getElementById('mOnes');
fillDigits(hTens,3);
fillDigits(hOnes,10);
fillDigits(mTens,6);
fillDigits(mOnes,10);

// adjust hour ones depending on tens
function adjustHourOnes(){
  const tens=getSelectedValue(hTens);
  if(tens===2){
    fillDigits(hOnes,4);
  }else{
    fillDigits(hOnes,10);
  }
  const idx=getSelectedIndex(hOnes);
  if(tens===2 && idx>3)setScroll(hOnes,3);
}

// add scroll listeners
[hTens].forEach(col=>{
  col.addEventListener('scroll',()=>{
    clearTimeout(col._timeout);
    col._timeout=setTimeout(adjustHourOnes,150);
  });
});

// render all days horizontally
function renderDates(monthDate=new Date()){
  const monthNames=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];
  monthLabel.textContent=monthNames[monthDate.getMonth()];
  datesRow.innerHTML='';
  const year=monthDate.getFullYear();
  const month=monthDate.getMonth();
  const lastDay=new Date(year,month+1,0).getDate();
  for(let day=1;day<=lastDay;day++){
    const d=new Date(year,month,day);
    const div=document.createElement('div');
    div.className='date-item';
    div.innerHTML=`${d.toLocaleDateString('de-DE',{weekday:'short'})}<span class="dom">${day}</span>`;
    div.onclick=()=>{
      document.querySelectorAll('.date-item').forEach(x=>x.classList.remove('active'));
      div.classList.add('active');
    };
    datesRow.appendChild(div);
  }
}

// month navigation
document.getElementById('prevMonth').onclick=()=>{
  currentBaseDate.setMonth(currentBaseDate.getMonth()-1);
  renderDates(currentBaseDate);
};
document.getElementById('nextMonth').onclick=()=>{
  currentBaseDate.setMonth(currentBaseDate.getMonth()+1);
  renderDates(currentBaseDate);
};

// prefill
window.addEventListener('DOMContentLoaded',async()=>{
  try{
    const res=await fetch(apiUrl);
    if(!res.ok)return;
    const user=await res.json();
    if(user.CallDate){
      const [day,month,year]=user.CallDate.split('/');
      currentBaseDate=new Date(`${year}-${month}-${day}`);
    }
    renderDates(currentBaseDate);

    document.getElementById('userName').textContent=user.Username||'';
    document.getElementById('userPhone').textContent=user.PhoneNumber||'';

    // select and center
    const targetDay=currentBaseDate.getDate();
    const activeEl=[...datesRow.children].find(el=>el.querySelector('.dom').textContent==targetDay);
    if(activeEl){
      activeEl.classList.add('active');
      // auto center
      datesRow.scrollLeft=activeEl.offsetLeft - datesRow.clientWidth/2 + activeEl.clientWidth/2;
    }

    // set clock from API time
    let time=user.CallTime||'09:00';
    let [h,m]=time.split(':');
    h=h.padStart(2,'0');m=m.padStart(2,'0');
    setScroll(hTens,parseInt(h[0]));
    setScroll(hOnes,parseInt(h[1]));
    setScroll(mTens,parseInt(m[0]));
    setScroll(mOnes,parseInt(m[1]));
  }catch(err){console.error("Prefill error:",err);}
});

// save
document.getElementById('saveBtn').onclick=async()=>{
  let selectedDay=document.querySelector('.date-item.active .dom')?.textContent;
  let selectedMonth=currentBaseDate.getMonth()+1;
  let selectedYear=currentBaseDate.getFullYear();
  let formattedDate=`${selectedDay}/${selectedMonth.toString().padStart(2,'0')}/${selectedYear}`;
  const h=parseInt(getSelectedValue(hTens).toString()+getSelectedValue(hOnes).toString());
  const m=parseInt(getSelectedValue(mTens).toString()+getSelectedValue(mOnes).toString());
  const formattedTime=`${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
  const data={
    PhoneNumber:document.getElementById('userPhone').textContent,
    CallDate:formattedDate,
    CallTime:formattedTime
  };
  try{
    const res=await fetch(apiUrl,{
      method:'PUT',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    if(res.ok){alert("✔️ Ihre Rückrufdaten wurden erfolgreich angepasst.");}
    else{alert("❌ Fehler beim Speichern der Rückrufdaten.");}
  }catch(err){alert("🚨 Fehler: "+err.message);}
};
</script>
</body>
</html>
